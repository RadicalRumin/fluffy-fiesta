# PHP
# Test and package your PHP project.
# Add steps that run tests, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/php

pool:
  vmImage: 'ubuntu-latest'

variables:
  PHP_VERSION: '8.0.2'
  PHPUNIT_VERSION: '9.5.10'

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '14.x'

- script: |
    sudo apt-get update
    sudo apt-get install -y php${{ env.PHP_VERSION }} php${{ env.PHP_VERSION }}-cli php${{ env.PHP_VERSION }}-mbstring unzip
    curl -sS https://getcomposer.org/installer -o composer-setup.php
    sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer
    sudo composer global require "phpunit/phpunit:${{ env.PHPUNIT_VERSION }}"
    sudo ln -s /root/.composer/vendor/bin/phpunit /usr/local/bin/phpunit
  displayName: 'Install PHP and Composer'

- script: |
    sudo apt-get install -y git
    git clone https://github.com/RadicalRumin/fluffy-fiesta.git
    cd fluffy-fiesta
    composer install
  displayName: 'Clone and install dependencies'

- script: |
    phpunit
  displayName: 'Run PHPUnit tests'